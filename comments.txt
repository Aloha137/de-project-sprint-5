Максим, привет! Рад знакомству :)

Добавил уникальное составное поле для cdm.dm_courier_ledger.
Про создание подключения к API в Airflow буду иметь в виду в будущем.

По поводу того, что загружу 50 записей: я зашил в логику метода apiclient.get(), чтобы за каждый проход цикла увеличивался offset.

По поводу "защелки" для фильтрации данных: как показывает практика система-источник может не поставлять своевременно данные и если использовать зашитый временной интервал может оказаться так, что когда-нибудь данных не окажется за этот интервал и получится окно. Если я правильно всё понял))

Согласен, что можно было отфильтровать раньше записи deliveries.

Настроил расписание дага cdm на 9 утра 10-го числа каждого месяца. Думаю как бы сделать еще так, чтобы при повторном запуске дага не было краша в связи с уже имеющимися данными. Быть может имеет смысл добавить обработку исключений, как считаешь ?

Спасибо за объяснения касательно инкрементальной загрузки. Я так понимаю, чтобы всегда соблюдалось условие идемпотентности можно использовать вшитый в sql механизм INSERT ... ON CONFLICT .

Cпасибо за наводку про external_task_sensor.