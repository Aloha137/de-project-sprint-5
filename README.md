# Проект 5-го спринта

### Описание
Репозиторий предназначен для сдачи проекта 5-го спринта. Конечная задача — реализовать витрину для расчётов с курьерами. В ней необходимо рассчитать суммы оплаты каждому курьеру за предыдущий месяц. Для этого нужно объединить данных из 3-х подсистем:
* подсистема обработки заказов
* подсистема оплат баллами
* подсистема курьерской доставки
После этапа проектировния DWH было решено использовать следующие слои STG -> DDS -> CDM.
Также в каждом слое будет присутстовать техническая таблица (srv_wf_settings) для отслеживания последних загруженных данных, чтобы реализовать механизм инкрементальной загрузки.

В рамках этого проекта мною был использован ООП подход для написания кода. 


### Структура репозитория
- `/src/dags/core/stg/init_schema_dag/` DAG для исполнения DDL инструкций по созданию всех таблиц DWH
- `/src/dags/core/stg/bonus_system_ranks_dag` DAG для загрузки сырых данных из подсистемы оплат баллами
- `/src/dags/core/stg/couriers_deliveries` DAG для загрузки сырых данных из подсистемы курьерской доставки
- `/src/dags/core/stg/order_system_restaurants_dag` DAG для загрузки сырых данных из подсистемы обработки заказов
- `/src/dags/core/dds` DAG для загрузки данных в dds-слой
- `/src/dags/core/cdm` DAG для загрузки данных в cdm-cлой
- `/src/dags/lib` набор вспомогательных функций для обработки данных, а также конфигурации подключения с базам данных


### Как запустить контейнер
Запустите локально команду:

```
docker run \
-d \
-p 3000:3000 \
-p 3002:3002 \
-p 15432:5432 \
--mount src=airflow_sp5,target=/opt/airflow \
--mount src=lesson_sp5,target=/lessons \
--mount src=db_sp5,target=/var/lib/postgresql/data \
--name=de-sprint-5-server-local \
sindb/de-pg-cr-af:latest
```

После того как запустится контейнер, вам будут доступны:
- Airflow
	- `localhost:3000/airflow`
- БД
	- `jovyan:jovyan@localhost:15432/de`